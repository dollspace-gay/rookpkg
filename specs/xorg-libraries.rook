[package]
name = "xorg-libraries"
version = "7.8"
release = 1
summary = "X.Org client libraries"
description = """
Meta-package for the core X.Org client libraries including libX11, libXext,
libXrender, libXrandr, libXi, libXcursor, libXcomposite, libXdamage, and
other essential X11 libraries.
"""
homepage = "https://www.x.org/"
license = "MIT"
maintainer = "Friendly Society of Corvids <corvids@rookeryos.dev>"
arch = "x86_64"

[sources]
# BLFS: 32 X11 libraries in build order
source0 = { url = "https://xorg.freedesktop.org/archive/individual/lib/xtrans-1.6.0.tar.gz", sha256 = "936b74c60b19c317c3f3cb1b114575032528dbdaf428740483200ea874c2ca0a" }
source1 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libX11-1.8.12.tar.xz", sha256 = "fa026f9bb0124f4d6c808f9aef4057aad65e7b35d8ff43951cef0abe06bb9a9a" }
source2 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXext-1.3.6.tar.xz", sha256 = "edb59fa23994e405fdc5b400afdf5820ae6160b94f35e3dc3da4457a16e89753" }
source3 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libFS-1.0.10.tar.gz", sha256 = "38daddf6aaad25d93c6ff762c9629b8f10b19e8c4b70fcf117ec38c440ff9ae2" }
source4 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libICE-1.1.2.tar.xz", sha256 = "974e4ed414225eb3c716985df9709f4da8d22a67a2890066bc6dfc89ad298625" }
source5 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libSM-1.2.6.tar.xz", sha256 = "be7c0abdb15cbfd29ac62573c1c82e877f9d4047ad15321e7ea97d1e43d835be" }
source6 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXScrnSaver-1.2.4.tar.xz", sha256 = "75cd2859f38e207a090cac980d76bc71e9da99d48d09703584e00585abc920fe" }
source7 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXt-1.3.1.tar.xz", sha256 = "e0a774b33324f4d4c05b199ea45050f87206586d81655f8bef4dba434d931288" }
source8 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXmu-1.2.1.tar.xz", sha256 = "fcb27793248a39e5fcc5b9c4aec40cc0734b3ca76aac3d7d1c264e7f7e14e8b2" }
source9 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXpm-3.5.17.tar.xz", sha256 = "64b31f81019e7d388c822b0b28af8d51c4622b83f1f0cb6fa3fc95e271226e43" }
source10 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXaw-1.0.16.tar.xz", sha256 = "731d572b54c708f81e197a6afa8016918e2e06dfd3025e066ca642a5b8c39c8f" }
source11 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXfixes-6.0.1.tar.xz", sha256 = "b695f93cd2499421ab02d22744458e650ccc88c1d4c8130d60200213abc02d58" }
source12 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXcomposite-0.4.6.tar.xz", sha256 = "fe40bcf0ae1a09070eba24088a5eb9810efe57453779ec1e20a55080c6dc2c87" }
source13 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXrender-0.9.12.tar.xz", sha256 = "b832128da48b39c8d608224481743403ad1691bf4e554e4be9c174df171d1b97" }
source14 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXcursor-1.2.3.tar.xz", sha256 = "fde9402dd4cfe79da71e2d96bb980afc5e6ff4f8a7d74c159e1966afb2b2c2c0" }
source15 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXdamage-1.1.6.tar.xz", sha256 = "52733c1f5262fca35f64e7d5060c6fcd81a880ba8e1e65c9621cf0727afb5d11" }
source16 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libfontenc-1.1.8.tar.xz", sha256 = "7b02c3d405236e0d86806b1de9d6868fe60c313628b38350b032914aa4fd14c6" }
source17 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXfont2-2.0.7.tar.xz", sha256 = "8b7b82fdeba48769b69433e8e3fbb984a5f6bf368b0d5f47abeec49de3e58efb" }
source18 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXft-2.3.9.tar.xz", sha256 = "60a25b78945ed6932635b3bb1899a517d31df7456e69867ffba27f89ff3976f5" }
source19 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXi-1.8.2.tar.xz", sha256 = "d0e0555e53d6e2114eabfa44226ba162d2708501a25e18d99cfb35c094c6c104" }
source20 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXinerama-1.1.5.tar.xz", sha256 = "5094d1f0fcc1828cb1696d0d39d9e866ae32520c54d01f618f1a3c1e30c2085c" }
source21 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXrandr-1.5.4.tar.xz", sha256 = "1ad5b065375f4a85915aa60611cc6407c060492a214d7f9daf214be752c3b4d3" }
source22 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXres-1.2.2.tar.xz", sha256 = "9a7446f3484b9b7538ac5ee30d2c1ce9e5b7fbbaf1440e02f6cca186a1fa745f" }
source23 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXtst-1.2.5.tar.xz", sha256 = "b50d4c25b97009a744706c1039c598f4d8e64910c9fde381994e1cae235d9242" }
source24 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXv-1.0.13.tar.xz", sha256 = "7d34910958e1c1f8d193d828fea1b7da192297280a35437af0692f003ba03755" }
source25 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXvMC-1.0.14.tar.xz", sha256 = "e4be9eb6b6bafdbbf81f47f7163047215376e45e2dc786d0ea6181c930725ed9" }
source26 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXxf86dga-1.1.6.tar.xz", sha256 = "be44427579808fe3a217d59f51cae756a26913eb6e4c8738ccab65ff56d7980f" }
source27 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXxf86vm-1.1.6.tar.xz", sha256 = "96af414c73ce1d5449ad04be7f9f27fa8330f844b6dda843ef22e3e1befb3ee3" }
source28 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libpciaccess-0.18.1.tar.xz", sha256 = "4af43444b38adb5545d0ed1c2ce46d9608cc47b31c2387fc5181656765a6fa76" }
source29 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libxkbfile-1.1.3.tar.xz", sha256 = "a9b63eea997abb9ee6a8b4fbb515831c841f471af845a09de443b28003874bec" }
source30 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libxshmfence-1.3.3.tar.xz", sha256 = "d4a4df096aba96fea02c029ee3a44e11a47eb7f7213c1a729be83e85ec3fde10" }
source31 = { url = "https://xorg.freedesktop.org/archive/individual/lib/libXpresent-1.0.1.tar.gz", sha256 = "8ebf8567a8f6afe5a64275a2ecfd4c84e957970c27299d964350f60be9f3541d" }

[patches]

[build_depends]
gcc = ">= 10.0"
make = ">= 4.0"
xorgproto = ">= 2024.1"
libxcb = ">= 1.17"
fontconfig = ">= 2.15"
freetype = ">= 2.13"
util-macros = ">= 1.20"

[depends]
glibc = ">= 2.39"
libxcb = ">= 1.17"
fontconfig = ">= 2.15"
freetype = ">= 2.13"

[optional_depends]

[environment]

[build]
prep = """
cd $ROOKPKG_BUILD
# Extract all 32 libraries (some use .tar.gz)
for pkg in xtrans libX11 libXext libFS libICE libSM libXScrnSaver libXt libXmu \
           libXpm libXaw libXfixes libXcomposite libXrender libXcursor libXdamage \
           libfontenc libXfont2 libXft libXi libXinerama libXrandr libXres libXtst \
           libXv libXvMC libXxf86dga libXxf86vm libpciaccess libxkbfile libxshmfence \
           libXpresent; do
    rm -rf ${pkg}-*
    tar xf $ROOKPKG_SOURCES/${pkg}-*.tar.* 2>/dev/null || true
done
"""

configure = """
cd $ROOKPKG_BUILD
# Configure all 32 libraries in correct build order
# Note: libpciaccess uses meson, handled separately in build step
for pkg in xtrans libICE libSM libXt libX11 libXext libFS libXScrnSaver libXmu \
           libXpm libXaw libXfixes libXcomposite libXrender libXcursor libXdamage \
           libfontenc libXfont2 libXft libXi libXinerama libXrandr libXres libXtst \
           libXv libXvMC libXxf86dga libXxf86vm libxkbfile libxshmfence libXpresent; do
    cd ${pkg}-*
    case $pkg in
        libXt)
            ./configure --prefix=/usr --sysconfdir=/etc --disable-static \
                        --with-appdefaultdir=/etc/X11/app-defaults
            ;;
        libXfont2)
            ./configure --prefix=/usr --sysconfdir=/etc --disable-static \
                        --disable-devel-docs
            ;;
        libXpm)
            ./configure --prefix=/usr --sysconfdir=/etc --disable-static \
                        --disable-open-zfile
            ;;
        *)
            ./configure --prefix=/usr --sysconfdir=/etc --disable-static
            ;;
    esac
    cd ..
done
"""

build = """
cd $ROOKPKG_BUILD
# Build autotools-based libraries
for pkg in xtrans libICE libSM libXt libX11 libXext libFS libXScrnSaver libXmu \
           libXpm libXaw libXfixes libXcomposite libXrender libXcursor libXdamage \
           libfontenc libXfont2 libXft libXi libXinerama libXrandr libXres libXtst \
           libXv libXvMC libXxf86dga libXxf86vm libxkbfile libxshmfence libXpresent; do
    cd ${pkg}-*
    make -j$ROOKPKG_JOBS
    cd ..
done
# Build libpciaccess with meson
cd libpciaccess-*
mkdir -p build && cd build
meson setup --prefix=/usr --buildtype=release ..
ninja -j$ROOKPKG_JOBS
cd ../..
"""

check = """
# Tests require running X server
"""

install = """
cd $ROOKPKG_BUILD
# Install autotools-based libraries
for pkg in xtrans libICE libSM libXt libX11 libXext libFS libXScrnSaver libXmu \
           libXpm libXaw libXfixes libXcomposite libXrender libXcursor libXdamage \
           libfontenc libXfont2 libXft libXi libXinerama libXrandr libXres libXtst \
           libXv libXvMC libXxf86dga libXxf86vm libxkbfile libxshmfence libXpresent; do
    cd ${pkg}-*
    make DESTDIR=$ROOKPKG_DESTDIR install
    cd ..
done
# Install libpciaccess
cd libpciaccess-*/build
DESTDIR=$ROOKPKG_DESTDIR ninja install
cd ../..
"""

[files]
"usr/lib/libX11.so" = { mode = 755 }
"usr/lib/libXext.so" = { mode = 755 }
"usr/lib/libXrender.so" = { mode = 755 }
"usr/lib/libXrandr.so" = { mode = 755 }
"usr/lib/libXi.so" = { mode = 755 }
"usr/lib/libXcursor.so" = { mode = 755 }
"usr/lib/libXcomposite.so" = { mode = 755 }
"usr/lib/libXdamage.so" = { mode = 755 }
"usr/lib/libXfixes.so" = { mode = 755 }
"usr/lib/libXft.so" = { mode = 755 }
"usr/lib/libXinerama.so" = { mode = 755 }
"usr/lib/libXtst.so" = { mode = 755 }
"usr/lib/libXv.so" = { mode = 755 }
"usr/lib/libXxf86vm.so" = { mode = 755 }
"usr/lib/libSM.so" = { mode = 755 }
"usr/lib/libICE.so" = { mode = 755 }
"usr/lib/libXt.so" = { mode = 755 }
"usr/lib/libXmu.so" = { mode = 755 }
"usr/lib/libXpm.so" = { mode = 755 }
"usr/lib/libXaw.so" = { mode = 755 }
"usr/include/X11/" = {}
"usr/lib/pkgconfig/x11.pc" = {}

[config_files]

[scripts]
pre_install = ""
post_install = "/sbin/ldconfig"
pre_remove = ""
post_remove = "/sbin/ldconfig"
pre_upgrade = ""
post_upgrade = "/sbin/ldconfig"

[[changelog]]
version = "7.8"
date = "2025-12-15"
author = "Friendly Society of Corvids <corvids@rookeryos.dev>"
changes = [
    "Initial Rookery OS package",
    "Based on BLFS 12.4 build instructions",
    "Includes all core X11 client libraries"
]

[metadata]
keywords = ["xorg", "x11", "libraries", "libx11"]
categories = ["x11", "libraries"]

[signing]
master_keys_dir = "/etc/rookpkg/keys/master"
packager_keys_dir = "/etc/rookpkg/keys/packager"

[security]
